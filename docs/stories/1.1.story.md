# Story 1.1: Initialisation Projet & Infrastructure

## Status

Done

## Story

**As a** developpeur,
**I want** un projet Next.js initialise avec toute l'infrastructure configuree,
**So that** je peux commencer a developper les fonctionnalites utilisateur.

## Acceptance Criteria

1. **Given** aucun projet existant, **When** j'execute la commande d'initialisation du starter template, **Then** un projet Next.js 15+ est cree avec TypeScript, Tailwind, ESLint, App Router, Turbopack
2. **And** shadcn/ui est initialise
3. **And** Supabase client est configure (supabase-js, ssr)
4. **And** Prisma est initialise avec le schema de base (users table)
5. **And** Vercel AI SDK est installe
6. **And** les variables d'environnement sont documentees dans .env.example
7. **And** le projet se deploie sur Vercel avec succes

## Tasks / Subtasks

- [x] Task 1: Initialize Next.js Project (AC: 1)
  - [x] Run `npx create-next-app@latest codebase-chat --typescript --tailwind --eslint --app --turbopack --import-alias "@/*"`
  - [x] Verify project structure matches App Router pattern
  - [x] Confirm TypeScript strict mode is enabled in tsconfig.json

- [x] Task 2: Initialize shadcn/ui (AC: 2)
  - [x] Run `npx shadcn@latest init`
  - [x] Select dark mode as default theme
  - [x] Configure base components.json for the project
  - [x] Install initial base UI components: button, input, textarea, card, dialog, dropdown-menu, scroll-area, skeleton, sonner (replaces deprecated toast), tooltip

- [x] Task 3: Setup Supabase Client (AC: 3)
  - [x] Install dependencies: `npm install @supabase/supabase-js @supabase/ssr`
  - [x] Create `lib/supabase/client.ts` for browser client
  - [x] Create `lib/supabase/server.ts` for server client (with cookies)
  - [x] Create `lib/supabase/admin.ts` placeholder for service role client
  - [x] Create `lib/supabase/middleware.ts` helper for auth middleware

- [x] Task 4: Initialize Prisma with Base Schema (AC: 4)
  - [x] Install dependencies: `npm install prisma @prisma/client`
  - [x] Run `npx prisma init`
  - [x] Configure `prisma/schema.prisma` with Supabase PostgreSQL provider
  - [x] Create `users` table schema with: id (UUID), github_id, email, name, avatar_url, github_token (encrypted), created_at, updated_at
  - [x] Add Prisma generate script to package.json

- [x] Task 5: Install Vercel AI SDK (AC: 5)
  - [x] Install dependencies: `npm install ai @ai-sdk/anthropic`
  - [x] Create `lib/ai/client.ts` placeholder for Vercel AI SDK setup
  - [x] Create `lib/ai/prompts.ts` placeholder for system prompts

- [x] Task 6: Install Additional Utilities
  - [x] Install Zod: `npm install zod`
  - [x] Install React Query: `npm install @tanstack/react-query`
  - [x] Install Lucide icons: `npm install lucide-react`
  - [x] Create `lib/utils/cn.ts` utility for className merging (created by shadcn at lib/utils.ts)

- [x] Task 7: Setup Environment Variables (AC: 6)
  - [x] Create `.env.example` with all required variables documented
  - [x] Create `.env.local` (gitignored) with placeholder values
  - [x] Add comments explaining each variable's purpose
  - [x] Variables documented:
    - NEXT_PUBLIC_SUPABASE_URL
    - NEXT_PUBLIC_SUPABASE_ANON_KEY
    - SUPABASE_SERVICE_ROLE_KEY
    - DATABASE_URL
    - DIRECT_URL
    - ANTHROPIC_API_KEY
    - KV_REST_API_URL
    - KV_REST_API_TOKEN

- [x] Task 8: Configure Project Structure
  - [x] Create base directory structure per architecture:
    - `app/(auth)/`
    - `app/(dashboard)/`
    - `app/(marketing)/`
    - `app/api/`
    - `components/ui/`
    - `components/chat/`
    - `components/layout/`
    - `components/auth/`
    - `components/shared/`
    - `lib/supabase/`
    - `lib/ai/`
    - `lib/github/`
    - `lib/utils/`
    - `lib/validators/`
    - `types/`
    - `hooks/`
    - `providers/`
  - [x] Create barrel export files (index.ts) in component folders
  - [x] Create `types/index.ts` for re-exports

- [x] Task 9: Setup Base Layout and Providers
  - [x] Create `providers/QueryProvider.tsx` for React Query
  - [x] Create `providers/ThemeProvider.tsx` for dark mode (next-themes)
  - [x] Create `providers/ToastProvider.tsx` using sonner
  - [x] Update `app/layout.tsx` with providers wrapper
  - [x] Setup `app/globals.css` with Tailwind + custom CSS variables for Fun & Vibrant theme (pink #EC4899)

- [x] Task 10: Create Middleware for Auth (AC: 7 prep)
  - [x] Create `middleware.ts` at project root
  - [x] Configure route protection patterns for `/dashboard/*` routes
  - [x] Integrate Supabase auth middleware helper

- [x] Task 11: Verify Deployment Readiness (AC: 7)
  - [x] Ensure `next.config.ts` is properly configured
  - [x] Verify all required dependencies are in package.json
  - [x] Run `npm run build` locally to ensure no build errors
  - [x] Document deployment steps in README.md

## Dev Notes

### Architecture Reference
All technical details below are extracted from the Architecture Document.

### Project Initialization Command
[Source: architecture.md#Starter Template Evaluation]
```bash
npx create-next-app@latest codebase-chat --typescript --tailwind --eslint --app --turbopack --import-alias "@/*"
```

### Post-initialization Setup
[Source: architecture.md#Post-initialization Setup]
```bash
# UI Components
npx shadcn@latest init

# Database + Auth (Supabase - MANDATORY)
npm install @supabase/supabase-js @supabase/ssr
npm install prisma @prisma/client
npx prisma init

# AI SDK for streaming
npm install ai @ai-sdk/anthropic

# Additional utilities
npm install zod @tanstack/react-query
```

### Technology Stack
[Source: architecture.md#Infrastructure Decisions]
| Component | Technology |
|-----------|------------|
| Framework | Next.js 15+ App Router |
| Database | Supabase PostgreSQL |
| ORM | Prisma |
| Authentication | Supabase Auth |
| AI Provider | Anthropic Claude via Vercel AI SDK |
| UI | shadcn/ui + Tailwind |
| Deployment | Vercel |

### Database Schema - Users Table
[Source: architecture.md#Data Architecture]
```sql
users (
  id            UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  github_id     TEXT UNIQUE NOT NULL,
  email         TEXT,
  name          TEXT,
  avatar_url    TEXT,
  github_token  TEXT ENCRYPTED,
  created_at    TIMESTAMPTZ DEFAULT NOW(),
  updated_at    TIMESTAMPTZ DEFAULT NOW()
)
```

### Prisma Schema Pattern
[Source: architecture.md#Naming Patterns]
- Tables: snake_case plural (users, repositories, messages)
- Columns: snake_case (user_id, created_at, github_token)
- Foreign keys: `{table}_id` pattern

### Environment Variables Required
[Source: architecture.md#Infrastructure & Deployment]
```
# Supabase (Auth + Database)
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# AI
ANTHROPIC_API_KEY=

# Cache
KV_REST_API_URL=
KV_REST_API_TOKEN=
```

### Project Structure
[Source: architecture.md#Complete Project Directory Structure]
Key directories to create:
- `app/` - App Router pages and API routes
- `components/` - React components organized by feature
- `lib/` - Utilities, clients, validators
- `types/` - TypeScript type definitions
- `hooks/` - Custom React hooks
- `providers/` - Context providers
- `prisma/` - Database schema and migrations

### File Naming Conventions
[Source: architecture.md#Naming Patterns]
- Components: PascalCase.tsx (e.g., `ChatMessage.tsx`)
- Utility files: kebab-case.ts (e.g., `format-date.ts`)
- Co-located tests: `Component.test.tsx` next to `Component.tsx`

### UX Design Requirements
[Source: epics.md#Additional Requirements]
- Direction visuelle "Fun & Vibrant" avec dark mode par defaut
- Couleur dominante rose (#EC4899) avec glow effects
- shadcn/ui comme base de composants avec personnalisation

### Testing

#### Test File Location
[Source: architecture.md#Structure Rules]
- Co-located tests: `Component.test.tsx` next to `Component.tsx`

#### Test Standards
- Test framework: Vitest (recommended in architecture)
- Components should have corresponding test files

#### Testing Requirements for This Story
- Verify build succeeds with `npm run build`
- Verify TypeScript has no errors with `npm run lint`
- Manual verification of project structure alignment

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-09 | 0.1 | Initial story draft created | SM Agent |
| 2026-01-09 | 1.0 | Implementation complete, all tasks done | Dev Agent (James) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- Build output: Successful compilation with Turbopack in 1720.3ms
- Prisma generate: Successfully generated Prisma Client v6.19.1
- ESLint: 0 errors, 0 warnings (after fixing unused variable warnings)

### Completion Notes List
1. Project was partially initialized before story execution - Next.js, Supabase clients already existed
2. shadcn/ui toast component is deprecated, used sonner instead as recommended
3. Prisma schema includes full database models (users, repositories, conversations, messages) for future stories
4. Fun & Vibrant pink theme (#EC4899) configured in globals.css dark mode with glow effect variable
5. Removed auto-generated prisma.config.ts as it requires dotenv (Next.js handles env natively)
6. Added DATABASE_URL and DIRECT_URL to environment variables for Prisma (not in original spec but required)
7. next-themes already installed by shadcn, used for ThemeProvider
8. Middleware deprecation warning in Next.js 16 (recommends "proxy" instead) - noted for future

### File List

**Created:**
- lib/supabase/admin.ts
- lib/ai/client.ts
- lib/ai/prompts.ts
- lib/github/client.ts
- lib/github/types.ts
- lib/utils/format-date.ts
- lib/validators/chat.ts
- lib/validators/user.ts
- lib/validators/repo.ts
- types/index.ts
- hooks/index.ts
- providers/index.ts
- providers/QueryProvider.tsx
- providers/ThemeProvider.tsx
- providers/ToastProvider.tsx
- components/chat/index.ts
- components/layout/index.ts
- components/auth/index.ts
- components/export/index.ts
- components/shared/index.ts
- app/(auth)/login/ (directory)
- app/(auth)/callback/ (directory)
- app/(dashboard)/chat/ (directory)
- app/(dashboard)/settings/ (directory)
- app/(marketing)/ (directory)
- app/api/chat/ (directory)
- app/api/repos/ (directory)
- app/api/conversations/ (directory)
- app/api/export/ (directory)

**Modified:**
- package.json (added scripts: dev with turbopack, db:generate, db:push, db:studio, postinstall)
- prisma/schema.prisma (full database schema with users, repositories, conversations, messages)
- .env.example (comprehensive with all required variables and comments)
- .env.local (added DATABASE_URL and DIRECT_URL placeholders)
- app/layout.tsx (added providers, updated metadata)
- app/globals.css (added Fun & Vibrant pink theme for dark mode)
- middleware.ts (added route protection logic for dashboard routes)
- README.md (comprehensive project documentation)
- lib/github/client.ts (fixed unused variable warnings)

**Deleted:**
- prisma.config.ts (unnecessary for Next.js)

**Generated by shadcn/ui:**
- components/ui/button.tsx
- components/ui/input.tsx
- components/ui/textarea.tsx
- components/ui/card.tsx
- components/ui/dialog.tsx
- components/ui/dropdown-menu.tsx
- components/ui/scroll-area.tsx
- components/ui/skeleton.tsx
- components/ui/tooltip.tsx
- components/ui/sonner.tsx
- lib/utils.ts
- components.json

## QA Results
_To be filled by QA Agent_
