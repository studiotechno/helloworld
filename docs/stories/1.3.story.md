# Story 1.3: Layout Application & Navigation

## Status

Done

## Story

**As a** utilisateur connecté,
**I want** voir une interface cohérente avec sidebar et header,
**So that** je puisse naviguer facilement dans l'application.

## Acceptance Criteria

1. **Given** je suis connecté, **When** j'accède au dashboard, **Then** je vois le layout avec sidebar collapsible (280px)
2. **And** je vois le header avec mon avatar/nom GitHub
3. **And** le thème dark mode est appliqué par défaut
4. **And** les couleurs "Fun & Vibrant" (rose #EC4899) sont utilisées
5. **And** le raccourci ⌘+B toggle la sidebar
6. **Given** je suis sur mobile (< 768px), **When** j'accède au dashboard, **Then** la sidebar est un drawer plein écran
7. **And** je peux swiper pour fermer

## Tasks / Subtasks

- [x] Task 1: Create Dashboard Layout Component (AC: 1, 2, 3, 4)
  - [x] Create `app/(dashboard)/layout.tsx` with sidebar + main area structure
  - [x] Implement responsive layout: sidebar 280px on desktop, drawer on mobile
  - [x] Apply dark mode theme with Fun & Vibrant colors (#EC4899 accent)
  - [x] Add CSS variables for glow effects (`--glow-pink`) - already configured in Story 1.1

- [x] Task 2: Create Sidebar Component (AC: 1, 5)
  - [x] Create `components/layout/Sidebar.tsx`
  - [x] Implement collapsible sidebar with smooth animation
  - [x] Add conversation list placeholder (for Epic 3)
  - [x] Add "Nouvelle conversation" button
  - [x] Implement ⌘+B keyboard shortcut to toggle sidebar

- [x] Task 3: Create TopBar/Header Component (AC: 2)
  - [x] Create `components/layout/TopBar.tsx`
  - [x] Display user avatar from GitHub (use session data)
  - [x] Display user name
  - [x] Add RepoSelector placeholder (for Epic 2)
  - [x] Add UserMenu dropdown with logout option

- [x] Task 4: Create UserMenu Component (AC: 2)
  - [x] Create `components/layout/UserMenu.tsx`
  - [x] Implement dropdown with avatar trigger
  - [x] Add "Se déconnecter" action
  - [x] Add settings link placeholder

- [x] Task 5: Create LogoutButton Component
  - [x] Create `components/auth/LogoutButton.tsx`
  - [x] Implement Supabase sign out
  - [x] Redirect to /login after logout
  - [x] Handle loading state during logout

- [x] Task 6: Mobile Responsive Layout (AC: 6, 7)
  - [x] Implement sidebar as drawer on mobile (< 768px)
  - [x] Add Sheet component from shadcn/ui
  - [x] Swipe gesture handled by Sheet component (uses Radix Dialog)
  - [x] Add hamburger menu button in header for mobile

- [x] Task 7: Install Required shadcn/ui Components
  - [x] Install Sheet component for mobile drawer
  - [x] DropdownMenu already installed (from Story 1.1)
  - [x] Install Separator for visual dividers
  - [x] Tooltip already installed (from Story 1.1)

- [x] Task 8: Unit Tests
  - [x] Write tests for Sidebar component (toggle, keyboard shortcut)
  - [x] Write tests for TopBar component (user info display)
  - [x] Write tests for UserMenu component (dropdown behavior)
  - [x] Write tests for LogoutButton (logout flow)

## Dev Notes

### Previous Story Context (1.2)
Story 1.2 implemented GitHub OAuth authentication:
- Login page at `/login` with LoginButton
- OAuth callback handler at `/auth/callback`
- Dashboard page at `app/(dashboard)/dashboard/page.tsx`
- User sync via `lib/auth/sync-user.ts`
- Middleware protecting `/dashboard`, `/chat`, `/settings` routes
- Avatar component already installed from shadcn/ui

### Files Created in Story 1.2
- `app/(auth)/login/page.tsx`
- `app/auth/callback/route.ts`
- `app/(dashboard)/dashboard/page.tsx`
- `components/auth/LoginButton.tsx`
- `components/auth/LoginError.tsx`
- `lib/auth/sync-user.ts`
- `lib/db/prisma.ts`

### Design System Reference (UX Spec)

**Direction visuelle : Fun & Vibrant**
- Dark mode par défaut
- Couleur dominante rose (#EC4899)
- Arrondis généreux (16-24px)
- Espacement très aéré (+40% vs standard)

**Layout specifications:**
| Élément | Spécification |
|---------|---------------|
| Sidebar width | 280px (collapsible) |
| Max-width chat | 800px (centré) |
| Border radius | sm: 8px, md: 12px, lg: 16px, xl: 24px |

**Color tokens (Dark Mode):**
```css
--bg-primary: #09090B
--bg-secondary: #18181B
--bg-tertiary: #27272A
--accent: #EC4899
--accent-light: #F472B6
--accent-glow: rgba(236,72,153,0.15)
```

### Architecture Reference

**Component Structure:**
```
components/
├── layout/
│   ├── index.ts           # Barrel export
│   ├── Sidebar.tsx
│   ├── Sidebar.test.tsx
│   ├── TopBar.tsx
│   ├── UserMenu.tsx
│   └── ConversationList.tsx  # Placeholder for Epic 3
├── auth/
│   ├── LogoutButton.tsx
│   └── index.ts
```

**Route Structure:**
```
app/(dashboard)/
├── layout.tsx             # Dashboard layout (this story)
├── dashboard/page.tsx     # Already created in 1.2
├── chat/                  # Placeholder
└── settings/              # Placeholder
```

### Keyboard Shortcuts
| Raccourci | Action |
|-----------|--------|
| `⌘ + B` | Toggle sidebar |
| `⌘ + N` | Nouvelle conversation (Epic 3) |

### Accessibility Requirements
- Focus visible sur tous les éléments interactifs (ring rose 2px)
- Touch targets minimum 44×44px
- ARIA labels sur Sidebar (`role="navigation"`)
- Support `prefers-reduced-motion`

## Testing Requirements

### Unit Tests
- Sidebar toggle functionality
- Keyboard shortcut handling (⌘+B)
- UserMenu dropdown open/close
- LogoutButton with mocked Supabase
- Responsive behavior (mobile drawer)

### Integration Tests
- Layout renders correctly with user session
- Logout redirects to /login
- Sidebar state persists across navigation

### Manual Testing
- Test on desktop (1024px+)
- Test on tablet (768-1023px)
- Test on mobile (< 768px)
- Test keyboard navigation
- Test swipe gesture on mobile

## Story Wrap Up

### Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-09 | 0.1 | Initial story draft created | SM Agent |
| 2026-01-09 | 1.0 | Implementation complete, all tasks done | Dev Agent (James) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
- Build: Successful compilation with Turbopack in ~1.9s
- Tests: 47 tests passing across 7 test files
- ESLint: 0 errors, 2 warnings (pre-existing in lib/github/client.ts)

### Completion Notes List
1. Created DashboardShell client component to manage sidebar state and mobile drawer
2. Dashboard layout wraps all (dashboard) routes with sidebar and topbar
3. Sidebar is 280px wide on desktop, collapsible via ⌘+B keyboard shortcut
4. Mobile uses Sheet component (Radix Dialog) for full-screen drawer
5. UserMenu displays avatar with dropdown containing settings and logout options
6. LogoutButton reusable component with loading state
7. All components follow Fun & Vibrant theme with #EC4899 accent and glow effects
8. Dashboard page simplified - no longer needs auth check (handled by layout)
9. Swipe gesture for mobile drawer is handled natively by Radix Sheet component

### File List

**Created:**
- app/(dashboard)/layout.tsx - Dashboard layout with auth check and DashboardShell
- components/layout/DashboardShell.tsx - Client component managing sidebar state and mobile drawer
- components/layout/Sidebar.tsx - Collapsible sidebar with keyboard shortcut
- components/layout/Sidebar.test.tsx - Unit tests for Sidebar (10 tests)
- components/layout/TopBar.tsx - Header with user menu and mobile menu button
- components/layout/TopBar.test.tsx - Unit tests for TopBar (6 tests)
- components/layout/UserMenu.tsx - Dropdown menu with user avatar trigger
- components/layout/UserMenu.test.tsx - Unit tests for UserMenu (7 tests)
- components/auth/LogoutButton.tsx - Standalone logout button component
- components/auth/LogoutButton.test.tsx - Unit tests for LogoutButton (7 tests)
- components/ui/sheet.tsx - Sheet component (installed via shadcn)
- components/ui/separator.tsx - Separator component (installed via shadcn)

**Modified:**
- components/layout/index.ts - Added exports for Sidebar, TopBar, UserMenu, DashboardShell
- components/auth/index.ts - Added export for LogoutButton
- app/(dashboard)/dashboard/page.tsx - Simplified to work within new layout

**Dependencies Added:**
None - Sheet and Separator are shadcn/ui components using existing Radix primitives

## QA Results
_To be filled by QA Agent_
